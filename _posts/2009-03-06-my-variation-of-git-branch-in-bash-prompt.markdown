---
layout: !binary |-
  cG9zdA==
status: !binary |-
  cHVibGlzaA==
published: true
title: My variation of Git branch in bash prompt
author: !binary |-
  S2Vsc2lu
author_login: !binary |-
  YWRtaW4=
author_email: !binary |-
  a2Vsc2luQHZhbGVmb3IuY29t
author_url: !binary |-
  aHR0cDovL2tlbHNpbi5uZXQ=
excerpt: !binary |-
  QWZ0ZXIgcmVhZGluZyBhbm90aGVyIGNvb2wgYmxvZyBwb3N0IGFib3V0IHB1
  dHRpbmcgeW91ciBjdXJyZW50IGdpdCBicmFuY2ggaW4geW91ciBiYXNoIHBy
  b21wdCBJIGRlY2lkZWQgSSBuZWVkZWQgdG8gdHJ5IHRoaXMgb3V0LiBPbmNl
  IEkgZ290IGl0IHdvcmtpbmcgSSBhZGRlZCBpbiBjb2xvciBjb2RpbmcgdG8g
  c2VlIHRoZSBzdGF0dXMgb2YgdGhlIGN1cnJlbnQgY2hlY2tvdXQgYXMgd2Vs
  bCE=
wordpress_id: 107
wordpress_url: !binary |-
  aHR0cDovL2Jsb2cua2Vsc2luLm5ldC8/cD0xMDc=
date: 2009-03-06 13:57:10.000000000 -08:00
categories:
- Computers
tags:
- Linux
- Ubuntu
- Debian
- Bash
comments:
- id: 7
  author: Mick T.
  author_email: !binary |-
    bWljay50aW1vbnkrYmxvZy5rZWxzaW4ubmV0QGdtYWlsLmNvbQ==
  author_url: !binary |-
    aHR0cDovL3RpbW9ueS5jb20vbWlja3pibG9n
  date: !binary |-
    MjAwOS0wMy0wNyAxMjo1MDozMSAtMDgwMA==
  date_gmt: !binary |-
    MjAwOS0wMy0wNyAxNzo1MDozMSAtMDgwMA==
  content: ! "Yeah, shells are just so friggin' powerful, I hate it when I have to
    use DOS as it almost feels like I've a limb missing or I've been lobotomised.\r\n\r\nHow
    did you get the code sections to format so nicely? Did you copy'n'paste from an
    IDE into the rich text editor or are you using a Wordpress plugin?\r\n\r\nCheers\r\nMick"
- id: 9
  author: Kelsin
  author_email: !binary |-
    a2Vsc2luQHZhbGVmb3IuY29t
  author_url: !binary |-
    aHR0cDovL2tlbHNpbi5uZXQ=
  date: !binary |-
    MjAwOS0wMy0wOSAxNjoxOToxOCAtMDcwMA==
  date_gmt: !binary |-
    MjAwOS0wMy0wOSAyMToxOToxOCAtMDcwMA==
  content: ! "I posted about it a couple of weeks ago. I just use emacs and the htmlize
    function. I did have to use a custom htmlize (not the one in the goodies package)
    but it works great. Just run F5 on a region and then copy and paste!\r\n\r\nhttp://blog.kelsin.net/2009/02/23/htmlize-bug-or-how-i-formatted-my-code-from-last-post/"
- id: 14
  author: Mick T.
  author_email: !binary |-
    bWljay50aW1vbnkrYmxvZy5rZWxzaW4ubmV0QGdtYWlsLmNvbQ==
  author_url: !binary |-
    aHR0cDovL2RvbmVnYWxmcmllbmRzLmJsb2dzcG90LmNvbS8=
  date: !binary |-
    MjAwOS0wMy0xMiAxMTowMjo1MiAtMDcwMA==
  date_gmt: !binary |-
    MjAwOS0wMy0xMiAxNjowMjo1MiAtMDcwMA==
  content: Sweet! Thanks. :)
- id: 31
  author: RaiulBaztepo
  author_email: !binary |-
    enhrYmhpbzhAbWFpbC5ydQ==
  author_url: !binary ""
  date: !binary |-
    MjAwOS0wMy0zMSAwNzowNTowOCAtMDcwMA==
  date_gmt: !binary |-
    MjAwOS0wMy0zMSAxMjowNTowOCAtMDcwMA==
  content: ! "Hello!\r\nVery Interesting post! Thank you for such interesting resource!
    \r\nPS: Sorry for my bad english, I'v just started to learn this language ;)\r\nSee
    you! \r\nYour, Raiul Baztepo"
- id: 644
  author: Jane Goody
  author_email: !binary |-
    dmluY2llMjNkZWw0MjJAZ21haWwuY29t
  author_url: !binary |-
    aHR0cDovL2xhc2VyZm9yc21va2luZy5ibG9nc3BvdC5jb20=
  date: !binary |-
    MjAwOS0wNC0yNCAwNjowNDo1MyAtMDcwMA==
  date_gmt: !binary |-
    MjAwOS0wNC0yNCAxMTowNDo1MyAtMDcwMA==
  content: Hey, cool tips. Perhaps I'll buy a glass of beer to that person from that
    chat who told me to go to your blog :)
- id: 646
  author: Kelsin
  author_email: !binary |-
    a2Vsc2luQHZhbGVmb3IuY29t
  author_url: !binary |-
    aHR0cDovL2tlbHNpbi5uZXQ=
  date: !binary |-
    MjAwOS0wNC0yNCAwNzo0MzoyNCAtMDcwMA==
  date_gmt: !binary |-
    MjAwOS0wNC0yNCAxMjo0MzoyNCAtMDcwMA==
  content: Glad it helped. I posted when I first added this to my prompt and now that
    I work in git daily (personal rails projects, home directory and at work) I find
    it I can't live without seeing what branch I'm in and the status. It also helps
    me remember to commit frequently and often which is a good habit anyway!
- id: 1468
  author: Offereobe
  author_email: !binary |-
    a2VyZW5hQGVtYWlsLnVh
  author_url: !binary |-
    aHR0cDovL2JlYXVtb250ZW50ZXJwcmlzZS5hY3RpdmVib2FyZC5jb20vZm9y
    dW0uc3Bhcms/Zm9ydW1JRD05MDg4NiZhbXA7cD0zJmFtcDt0b3BpY0lEPTI3
    ODk4MjEx
  date: !binary |-
    MjAwOS0wNS0yMyAwNDozNTozOCAtMDcwMA==
  date_gmt: !binary |-
    MjAwOS0wNS0yMyAwOTozNTozOCAtMDcwMA==
  content: emm.. love it..
- id: 6007
  author: Mike
  author_email: !binary |-
    bWlrZUBzYW1ib2RhdGEuY29t
  author_url: !binary ""
  date: !binary |-
    MjAxMC0wOC0wNiAxMjowODozOCAtMDcwMA==
  date_gmt: !binary |-
    MjAxMC0wOC0wNiAxNzowODozOCAtMDcwMA==
  content: Hmmm... type -t __git_ps1 works better for me in BASH 4.1
---
After reading another cool blog post about putting your current git branch in your bash prompt I decided I needed to try this out. Once I got it working I added in color coding to see the status of the current checkout as well!

First off, you need bash-completion and git installed on your server (bash-completion and git-core on Debian/Ubuntu). Once installed you can enable bash completion in the system wide bash file (/etc/bash.bashrc) or in your own ~/.bashrc by adding these lines (Clearly if you are not on Debian/Ubuntu double check file paths):
<pre style="color: #bebebe; background-color: #262626; padding: 5px; overflow: auto;"><span style="color: #add8e6;"># </span><span style="color: #add8e6;">Completion
</span><span style="color: #afeeee; font-weight: bold;">if</span> [ -f /etc/bash_completion ]; <span style="color: #afeeee; font-weight: bold;">then</span>
    <span style="color: #7fffd4;">.</span> /etc/bash_completion
<span style="color: #afeeee; font-weight: bold;">fi</span></pre>
Once this is all set you should have a function called __git_ps1 available. Try it out by just running "__git_ps1" on your command line from a git repo. You should get the branch name returned inside parenthesis's.

Now comes my variations on how to include this in your prompt. My entire ~/.bash_prompt file can be found on my <a title="Bash Prompt Config File" href="http://git.dreaminginlyrics.com/?p=configs.git;a=blob_plain;f=.bash_aliases;hb=HEAD">git repo</a>. I source this file into my <a title="Bashrc" href="http://git.dreaminginlyrics.com/?p=configs.git;a=blob_plain;f=.bashrc;hb=HEAD">~/.bashrc</a>. The two most interesting parts are the function that determines the color of the branch based on git-status output and the function that gets the branch name. Branch name is pretty simple. We check that the __git_ps1 function is available and if it is, check that we're in a branch using it. If we are we echo the branch name. Pretty clean.
<pre style="color: #bebebe; background-color: #262626; padding: 5px; overflow: auto;">prompt_git_branch() {
    <span style="color: #afeeee; font-weight: bold;">if </span><span style="color: #7fffd4;">type</span> -p __git_ps1; <span style="color: #afeeee; font-weight: bold;">then</span>
        <span style="color: #40e0d0; font-weight: bold;">branch</span>=$(<span style="color: #fa8072;">__git_ps1</span> <span style="color: #87cefa;">'%s'</span>)
        <span style="color: #afeeee; font-weight: bold;">if</span> [ -n <span style="color: #87cefa;">"$branch"</span> ]; <span style="color: #afeeee; font-weight: bold;">then</span>
            <span style="color: #7fffd4;">echo</span> -e <span style="color: #87cefa;">"$branch"</span>
        <span style="color: #afeeee; font-weight: bold;">fi</span>
    <span style="color: #afeeee; font-weight: bold;">fi</span>
}</pre>
The next function has to grep stuff out of git status to determine what state the repo is in. If we are completely up to date we use green. If I have local changes it's blue. If we have files in our index ready to be committed I use red. This is really great with my home directory cause it helps remind me to add new dotfiles that I don't care about to .gitignore (or commit them if they should be public config files).
<pre style="color: #bebebe; background-color: #262626; padding: 5px; overflow: auto;">prompt_git_branch_color() {
    <span style="color: #afeeee; font-weight: bold;">if </span><span style="color: #7fffd4;">type</span> -p __git_ps1; <span style="color: #afeeee; font-weight: bold;">then</span>
        <span style="color: #40e0d0; font-weight: bold;">branch</span>=$(<span style="color: #fa8072;">__git_ps1</span> <span style="color: #87cefa;">'%s'</span>)
        <span style="color: #afeeee; font-weight: bold;">if</span> [ -n <span style="color: #87cefa;">"$branch"</span> ]; <span style="color: #afeeee; font-weight: bold;">then</span>
            <span style="color: #40e0d0; font-weight: bold;">status</span>=$(<span style="color: #fa8072;">git</span> status 2> /dev/null)

            <span style="color: #afeeee; font-weight: bold;">if</span> $(<span style="color: #fa8072;">echo</span> $<span style="color: #40e0d0; font-weight: bold;">status</span> | grep <span style="color: #87cefa;">'added to commit'</span> &amp;> /dev/null); <span style="color: #afeeee; font-weight: bold;">then</span>
            <span style="color: #add8e6;"># </span><span style="color: #add8e6;">If we have modified files but no index (blue)
</span>                <span style="color: #7fffd4;">echo</span> -e <span style="color: #87cefa;">"\033[1;34m"</span>
            <span style="color: #afeeee; font-weight: bold;">else</span>
                <span style="color: #afeeee; font-weight: bold;">if</span> $(<span style="color: #fa8072;">echo</span> $<span style="color: #40e0d0; font-weight: bold;">status</span> | grep <span style="color: #87cefa;">'to be committed'</span> &amp;> /dev/null); <span style="color: #afeeee; font-weight: bold;">then</span>
                <span style="color: #add8e6;"># </span><span style="color: #add8e6;">If we have files in index (red)
</span>                    <span style="color: #7fffd4;">echo</span> -e <span style="color: #87cefa;">"\033[1;31m"</span>
                <span style="color: #afeeee; font-weight: bold;">else</span>
                <span style="color: #add8e6;"># </span><span style="color: #add8e6;">If we are completely clean (green)
</span>                    <span style="color: #7fffd4;">echo</span> -e <span style="color: #87cefa;">"\033[1;32m"</span>
                <span style="color: #afeeee; font-weight: bold;">fi</span>
            <span style="color: #afeeee; font-weight: bold;">fi</span>
        <span style="color: #afeeee; font-weight: bold;">fi</span>
    <span style="color: #afeeee; font-weight: bold;">fi</span>
}</pre>
It took some playing but I finally found the right final line to correctly tell bash which characters in the prompt are visible. If anyone has a good way of making these functions smaller or faster I'd love to hear it. I had some trouble making sure that the functions were always executed (not just on a new shell's creation, but on every display of PS1). The delay this causes is not noticeable on all of my computers but more speed never hurts.
